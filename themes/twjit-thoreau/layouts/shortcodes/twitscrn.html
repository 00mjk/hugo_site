{{- /*
  This shortcode takes the following form:
  twitscrn imageUrl, alt, width, height, twitterUrl
*/ -}}

{{/* init vars */}}
{{- $respSizes := slice "300" "450" "600" "750" "900" "1050" "1200" "1350" "1500" -}}
{{- $imageUrl := .Get "imageUrl" -}}
{{- $alt := .Get "alt" -}}
{{- $width := .Get "width" -}}
{{- $height := .Get "height" -}}
{{- $twitterUrl := .Get "twitterUrl" -}}

{{/*
  separating the Cloudinary-related vars for greater flexibility, especially in case somebody else
  wants to borrow this code for his/her own Cloudinary setup and transformation ("xFm") choices
*/}}
{{- $cloudiBase := "https://res.cloudinary.com/brycewray-com/image/upload/" -}}
{{- $LQIPholder := "f_auto,q_1,w_20/" -}}
{{- $xFmPart1 := "f_auto,q_auto:eco,w_" -}}
{{- $xFmPart2 := ",x_0,z_1/" -}}

{{- $imgClass := "containedImage lazy" -}}
{{- $nscClass := "containedImage" -}}
{{- $dataSzes := "(min-width: 1024px) 100vw, 50vw" -}}
{{- $stringtoRet := "" -}}{{/* init */}}
{{- $separator := ", " -}}
{{- $innerString := "" -}}{{/* init */}}

{{- $stringtoRet := printf "%s%s%s%s%s%s%s%s%s%s%s%s%s%s%s" "<div class='twitter-tweet' aspect-ratio='" $width " / " $height "'><a href='" $twitterUrl "' target='_blank' rel='noopener'><img class='" $imgClass "' data-src='" $cloudiBase $xFmPart1 "600" $xFmPart2 $imageUrl "' data-srcset='" -}}

{{- $.Scratch.Set "innerString" $stringtoRet -}}
{{- range $respSizes -}}
  {{- if ge $width -}}
    {{- $innerString := printf "%s%s%s%s%s%s%s%s%s%s" $innerString $cloudiBase $xFmPart1 . $xFmPart2 $imageUrl " " . "w" $separator -}}
    {{-  $.Scratch.Add "innerString" $innerString -}}
  {{- end -}}
{{- end -}}
{{- $stringtoRet := .Scratch.Get "innerString" -}}
{{- $stringtoRet := substr $stringtoRet 0 -2 -}}
{{- $stringtoRet := printf "%s%s%s%s%s%s%s%s%s%s" $stringtoRet "' alt='" $alt "' width='" $width "' height='" $height "' loading='lazy' sizes='" $dataSzes "' /></a>" -}}
{{- $stringtoRet := printf "%s%s%s%s%s%s%s%s%s%s%s%s%s%s" $stringtoRet "<noscript><a href='" $twitterUrl "' target='_blank' rel='noopener'><img class='" $nscClass "' src='" $cloudiBase $xFmPart1 "300" $xFmPart2 $imageUrl "' alt='" $alt "' /></a></noscript></div>" -}}

{{- $stringtoRet | safeHTML -}}
