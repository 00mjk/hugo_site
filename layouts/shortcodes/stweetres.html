{{- /*
	=======
	Based on...
	- https://github.com/gohugoio/hugo/blob/master/tpl/tplimpl/embedded/templates/shortcodes/twitter.html
	- https://github.com/gohugoio/hugo/blob/master/tpl/tplimpl/embedded/templates/shortcodes/twitter_simple.html
	- https://developer.twitter.com/en/docs/twitter-api/v1/tweets/post-and-engage/api-reference/get-statuses-oembed
	=======
*/ -}}

{{- $user := .Get "user" -}}
{{- $id := .Get "id" -}}
{{- $url := printf "https://twitter.com/%v/status/%v" $user $id -}}
{{- $query := querify "url" $url "dnt" true "omit_script" true -}}
{{- $request := printf "https://publish.twitter.com/oembed?%s" $query -}}

{{- with resources.GetRemote $request -}}
	{{- $raw := .Content -}}
  {{- $json := unmarshal .Content -}}
	{{- $result := $json.html -}}

	{{- $result = replace $result "</a></blockquote>" "</a> <span class='legal'>(UTC)</span></blockquote>" -}}
	{{- $result = replace $result "!<a" "! <a" -}}
	{{- $result = replace $result ".<a" ". <a" }}
	{{- $result = replace $result ">https://t.co/QPSmjqXwft" ">brycewray.com" -}}
	{{- $result = replace $result ">https://t.co/Oeoaacz8z8" ">brycewray.com/posts/2019/02/â€¦" -}}
	{{- $result = replace $result ">https://t.co/ErdQPfeAps" ">brycewray.com/posts/2019/06/â€¦" -}}
	{{- $result = replace $result ">https://t.co/RXBMHpqW3e" ">netlify.com/products/analytics/" -}}
	{{- $result = replace $result "IÂ’â€™ll" "Iâ€™ll" -}}
	{{- $result = replace $result "ðŸ˜„<a" "ðŸ˜„ <a" -}}
	{{- $result = replace $result ">https://t.co/wB96VIVOLn" ">buff.ly/2CGRCRK" -}}
	{{- $result = replace $result ">https://t.co/x6y4ksDwrt" ">m.youtube.com/watch?v=ab8RePâ€¦" -}}
	{{- $result = replace $result ">https://t.co/jsuCgadKmE" ">11ty.dev/docs/plugins/iâ€¦" -}}
	{{- $result = replace $result ":<a" ": <a" }}
	{{- $result = replace $result ">https://t.co/M2dJYnyAhc" ">11ty.dev/docs/languagesâ€¦" -}}
	{{- $result = replace $result ">https://t.co/99QL57gPPA" ">brycewray.com" -}}
	{{- $result = replace $result ">https://t.co/99QL57yqH8" ">brycewray.com" -}}
	{{- $result = replace $result ">https://t.co/cBGolS1bct" ">hugoconf.io" -}}

	{{- $result = $result | safeHTML -}}
	{{- $result -}}
	{{/*  {{- $raw -}}  */}}
	{{/*  {{- $json -}}  */}}
{{- else -}}
	<p class="ctr legal red">Tweet not found:<br />
		url = {{ $url }}
	</p>
{{- end -}}
